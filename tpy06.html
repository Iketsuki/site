<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Logic & Math Factory</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        .bubble-tail:after { content: ''; position: absolute; width: 0; height: 0; border-top: 20px solid transparent; border-bottom: 20px solid transparent; border-right: 20px solid white; left: -20px; top: 20px; }
        @keyframes flow { 0% { transform: translateX(0); } 100% { transform: translateX(100%); } }
        .token-flow { animation: flow 1.5s ease-in-out forwards; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); } 20%, 40%, 60%, 80% { transform: translateX(5px); } }
        .shake { animation: shake 0.3s; }
        .light-green { background-color: #10b981; }
        .light-red { background-color: #ef4444; }
        .light-yellow { background-color: #facc15; }
        .traffic-light { transition: background-color 0.3s, transform 0.3s; }
        .road-diverter { transition: transform 0.5s; }
        .draggable-fix { cursor: grab; user-select: none; }
        .code-block { cursor: grab; user-select: none; transition: transform 0.1s; }
        .assembly-area.drag-over { border: 2px dashed #3b82f6; background-color: #eff6ff; }
        .slider-input {
            -webkit-appearance: none; width: 100%; height: 8px; background: #d1d5db; border-radius: 4px; outline: none; transition: opacity .2s;
        }
        .slider-input::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 20px; height: 20px; background: #3b82f6; cursor: pointer; border-radius: 50%; border: 3px solid white; box-shadow: 0 0 2px rgba(0,0,0,0.5);
        }
        .road-blocked { background-color: #fee2e2; border: 2px solid #ef4444; opacity: 0.5; }
        /* Data Type Colors */
        .is-float { background-color: #3b82f6; /* blue-500 */ }
        .is-int { background-color: #10b981; /* emerald-500 */ }
        .operator-symbol { font-size: 2rem; font-weight: 800; width: 4rem; display: inline-block; text-align: center; }
    </style>
</head>
<body class="bg-slate-50 font-[Inter] text-slate-700 p-8">

    <header class="mb-12">
        <div class="max-w-6xl mx-auto p-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl shadow-lg">
            <h1 class="text-3xl font-extrabold">‚öôÔ∏è The Python Logic and Math Factory üè≠</h1>
            <p class="text-white/80">Operators, Calculator, If-Else, and Comparisons</p>
        </div>

        <div class="max-w-6xl mx-auto mt-6 relative">
            <div class="ml-24 p-4 bg-white rounded-2xl shadow-md bubble-tail border-2 border-purple-200 transition-all duration-300">
                <p id="mascot-speech-top" class="font-semibold text-purple-700">
                    Welcome to the Math Factory! We use powerful machines, called **Operators**, to transform raw number blocks into calculated results. Watch how each machine performs a unique mathematical job!
                </p>
            </div>
            <div class="absolute w-20 h-20 -top-4 rounded-full border-4 border-white shadow-xl bg-purple-100 p-1 z-10 flex items-center justify-center text-4xl">
                 ü§ñ
            </div>
        </div>
    </header>

    <section class="max-w-6xl mx-auto mb-12 bg-white rounded-xl shadow-lg border-2 border-yellow-400 p-6">
        <h2 class="text-2xl font-bold mb-6 text-yellow-600">4. The Arithmetic Operator Machines üõ†Ô∏è</h2>

        <div class="grid grid-cols-2 gap-8">
            <div>
                <h3 class="text-xl font-bold mb-3 text-blue-600">The Atomic Machines (A=10, B=3)</h3>
                <div class="space-y-3">
                    <div class="p-3 bg-gray-100 rounded-lg shadow-inner flex items-center">
                        <span class="operator-symbol text-yellow-500"> + </span>
                        <div><p class="font-semibold">The Fusion Press</p><p class="text-sm">Combines blocks. Result: 13</p></div>
                    </div>
                    <div class="p-3 bg-gray-100 rounded-lg shadow-inner flex items-center">
                        <span class="operator-symbol text-yellow-500"> - </span>
                        <div><p class="font-semibold">The Abrasive Cutter</p><p class="text-sm">Removes a specified amount. Result: 7</p></div>
                    </div>
                    <div class="p-3 bg-gray-100 rounded-lg shadow-inner flex items-center">
                        <span class="operator-symbol text-yellow-500"> * </span>
                        <div><p class="font-semibold">The Replication Stamper</p><p class="text-sm">Stamps out duplicates. Result: 30</p></div>
                    </div>
                    <div class="p-3 bg-red-100 rounded-lg shadow-inner flex items-center">
                        <span class="operator-symbol text-red-500"> / </span>
                        <div><p class="font-semibold">The Fluid Dispenser (Float)</p><p class="text-sm">Splits blocks, includes decimal liquid. Result: 3.33...</p></div>
                    </div>
                    <div class="p-3 bg-green-100 rounded-lg shadow-inner flex items-center">
                        <span class="operator-symbol text-green-500"> // </span>
                        <div><p class="font-semibold">The Whole Number Splitter</p><p class="text-sm">Splits into whole pieces, discards decimals. Result: 3</p></div>
                    </div>
                    <div class="p-3 bg-purple-100 rounded-lg shadow-inner flex items-center">
                        <span class="operator-symbol text-purple-500"> % </span>
                        <div><p class="font-semibold">The Remainder Isolator</p><p class="text-sm">Captures the small leftover piece. Result: 1</p></div>
                    </div>
                    <div class="p-3 bg-blue-100 rounded-lg shadow-inner flex items-center">
                        <span class="operator-symbol text-blue-500"> ** </span>
                        <div><p class="font-semibold">The Power Stack Machine</p><p class="text-sm">Multiplies the base by itself (exponent) times. Result: 8 (from 2 ** 3)</p></div>
                    </div>
                </div>
            </div>

            <div>
                <h3 class="text-xl font-bold mb-3 text-blue-600">The Factory Trace ‚öôÔ∏è</h3>
                <div class="bg-gray-800 p-4 rounded-lg mb-4 shadow-xl">
                    <p class="text-green-400 font-mono mb-2">FACTORY INPUTS:</p>
                    <div id="factory-memory" class="flex justify-around text-white font-mono text-lg">
                        <div class="text-center">A: <span id="val-a" class="is-int px-2 rounded">2</span></div>
                        <div class="text-center">B: <span id="val-b" class="is-int px-2 rounded">3</span></div>
                    </div>
                </div>
                
                <table class="w-full text-sm border-collapse bg-slate-100 shadow-md">
                    <thead>
                        <tr class="bg-blue-600 text-white">
                            <th class="p-2 border border-blue-700">Step</th>
                            <th class="p-2 border border-blue-700">Code</th>
                            <th class="p-2 border border-blue-700">Result Block</th>
                        </tr>
                    </thead>
                    <tbody id="trace-table-factory">
                        <tr id="step-3" class="hover:bg-blue-50">
                            <td class="p-2 border">3</td>
                            <td class="p-2 border font-mono">Power = A ** B</td>
                            <td class="p-2 border console-output"><span id="res-power" class="is-int px-2 rounded-full">8</span></td>
                        </tr>
                        <tr id="step-4" class="hover:bg-blue-50">
                            <td class="p-2 border">4</td>
                            <td class="p-2 border font-mono">Remainder = 8 % 3</td>
                            <td class="p-2 border console-output"><span id="res-remainder" class="is-int px-2 rounded-full">2</span></td>
                        </tr>
                        <tr id="step-5" class="hover:bg-blue-50">
                            <td class="p-2 border">5</td>
                            <td class="p-2 border font-mono">Clean_Cut = 7 // 2</td>
                            <td class="p-2 border console-output"><span id="res-cleancut" class="is-int px-2 rounded-full">3</span></td>
                        </tr>
                    </tbody>
                </table>
                <p id="factory-message" class="mt-4 p-3 bg-blue-100 rounded font-semibold text-blue-700 text-center">Power Stack machine activated! Result: 8</p>
            </div>
        </div>

        <hr class="my-6 border-yellow-300">

        <h3 class="text-xl font-bold mb-4 text-red-600">üö© The Trap: Messy vs. Clean Division (/) vs. (//)</h3>
        
        <div class="grid grid-cols-3 gap-6 items-center">
            <div class="bg-red-50 p-4 rounded-xl border-4 border-red-400 text-center">
                <p class="font-mono text-lg font-bold">clean_result = 10 / 3</p>
                <div id="bad-result" class="mt-3 p-2 bg-slate-800 text-white rounded console-output">
                    <span id="float-result" class="is-float px-3 py-1 rounded-lg">3.3333333333333335</span>
                </div>
                <p class="text-red-700 mt-2">Factory Alert! Float data detected! We only want **whole** pieces for this order!</p>
            </div>
            
            <div id="drag-drop-area" class="text-center p-4 border-dashed border-2 border-red-500 rounded-lg bg-white relative">
                <span id="missing-slash" class="text-5xl text-red-600 font-bold p-2 draggable-fix" draggable="true" data-fix="slash">/</span>
                <p class="mt-2 text-sm text-red-600 font-semibold">Drag the missing slash **/** to the code above to fix it!</p>
            </div>

            <div id="fixed-code-container" class="bg-green-50 p-4 rounded-xl border-4 border-green-400 text-center relative">
                <p id="fix-code-display" class="font-mono text-lg font-bold">clean_result = 10 / 3</p>
                <div id="fix-result" class="mt-3 p-2 bg-slate-800 text-white rounded console-output">
                    <span id="int-result" class="is-float px-3 py-1 rounded-lg">3.3333333333333335</span>
                </div>
                <div id="quality-badge" class="absolute inset-0 hidden items-center justify-center text-green-700 text-2xl font-black bg-green-900/10 rounded-xl">QUALITY CONTROL PASS!</div>
                <p class="text-green-700 mt-2">The **Whole Number Splitter** is now active!</p>
            </div>
        </div>

        <hr class="my-6 border-yellow-300">
        
        <h2 class="text-2xl font-bold mb-6 text-purple-600">5. The Data Control Panel üéõÔ∏è (input() & int())</h2>

        <h3 class="text-xl font-bold mb-4 text-red-600">üö© The Trap: Missing Type Filter (int())</h3>
        
        <div class="grid grid-cols-3 gap-6 items-center">
            <div class="bg-red-50 p-4 rounded-xl border-4 border-red-400 text-center">
                <p class="font-mono text-lg font-bold">result = num1 ** num2</p>
                <div class="mt-3 p-2 bg-slate-800 text-white rounded console-output">
                    <div class="text-red-400 text-lg font-bold vibrating">TYPE MISMATCH ERROR!</div>
                </div>
                <p class="text-red-700 mt-2">The Math Processor only accepts solid number blocks, not text data.</p>
            </div>

            <div class="col-span-2 p-4 bg-white rounded-xl border-4 border-green-400 relative">
                <h4 class="text-lg font-bold text-green-700 mb-2">Drag the Type Filters into the code:</h4>
                <div class="bg-slate-800 text-blue-300 font-mono rounded-lg p-3 flex justify-center items-center gap-1">
                    <span class="text-white">result = </span>
                    <span id="target-1" class="text-white font-bold inline-block p-1 bg-red-800/50 rounded-sm drop-target" data-variable="num1">num1</span>
                    <span class="text-white"> ** </span>
                    <span id="target-2" class="text-white font-bold inline-block p-1 bg-red-800/50 rounded-sm drop-target" data-variable="num2">num2</span>
                </div>
                
                <div id="filter-drag-area" class="mt-4 flex justify-center gap-4 bg-gray-200 p-3 rounded-lg">
                    <span class="text-2xl text-green-600 font-bold p-2 bg-white rounded-lg shadow draggable-fix" draggable="true" data-fix="int">int()</span>
                    <span class="text-2xl text-green-600 font-bold p-2 bg-white rounded-lg shadow draggable-fix" draggable="true" data-fix="int">int()</span>
                </div>
                <div id="fix-status" class="mt-3 text-center font-bold text-red-600">Missing filters! Drag both **int()** filters over the variable names.</div>
            </div>
        </div>

        <hr class="my-6 border-yellow-300">

        <h3 class="text-xl font-bold mb-4 text-green-600">üéÆ The Playground: Power Stack Mission (**)</h3>
        <p class="mb-4 text-center font-semibold p-2 bg-green-100 rounded">
            Mission Briefing: The warehouse needs a **Block 125**! Use a **5** base block and a **3** exponent block. Use the **Power Stack** machine (**).
        </p>

        <div class="flex justify-around items-center bg-gray-100 p-6 rounded-lg">
            <div class="text-center">
                <p class="font-bold text-lg">Target Block:</p>
                <div id="target-block" class="w-24 h-24 bg-yellow-400 border-4 border-yellow-600 flex items-center justify-center text-3xl font-black rounded-lg shadow-2xl">125</div>
            </div>
            
            <div class="text-center">
                <p class="font-bold text-lg mb-2">Enter Code (e.g., 5 ** 3):</p>
                <input type="text" id="power-input" class="p-2 border-2 border-blue-400 rounded-lg font-mono text-lg w-48 text-center" value="5 ** 3">
                <button onclick="runPowerStackChallenge()" class="block w-full mt-3 bg-green-600 text-white font-bold py-2 rounded-lg hover:bg-green-700">Run Power Stack! üöÄ</button>
            </div>

            <div class="text-center">
                <p class="font-bold text-lg">Result Block:</p>
                <div id="result-block" class="w-24 h-24 bg-gray-400 border-4 border-gray-600 flex items-center justify-center text-3xl font-black rounded-lg shadow-2xl">?</div>
            </div>
        </div>
        <p id="power-message" class="mt-4 text-center font-bold text-slate-700"></p>
    </section>

    ---

    <section class="max-w-6xl mx-auto mb-12 bg-white rounded-xl shadow-lg border-2 border-purple-400 p-6">
        <h2 class="text-2xl font-bold mb-6 text-purple-600">6 & 7. The Traffic Control Center: Conditionals üö¶</h2>

        <h3 class="text-xl font-bold mb-3 text-blue-600">6. If-Else Simulation: Score Check</h3>
        <div class="grid grid-cols-2 gap-8">
            <div>
                <div class="bg-gray-800 text-green-400 font-mono p-4 rounded-lg shadow-lg mb-4">
                    <p id="sim-line-1">score = 85</p>
                    <p id="sim-line-2">if score >= 70:</p>
                    <p id="sim-line-3" class="pl-4">status = "Pass"</p>
                    <p id="sim-line-4">else:</p>
                    <p id="sim-line-5" class="pl-4">status = "Fail"</p>
                    <p id="sim-line-6">print(status)</p>
                </div>
                <button onclick="runIfElseSimulation()" class="w-full bg-blue-600 text-white font-bold py-2 rounded-lg hover:bg-blue-700 transition">
                    ‚ñ∂Ô∏è Run Decision Flow
                </button>
            </div>

            <div class="bg-gray-100 p-4 rounded-lg border-2 border-blue-400 relative overflow-hidden">
                <div class="flex justify-around mb-4">
                    <p class="font-bold text-lg">Score: <span id="sim-score" class="text-xl text-blue-600">85</span></p>
                    <p class="font-bold text-lg">Status: <span id="sim-status" class="text-xl text-red-600">Empty</span></p>
                </div>

                <div class="flex justify-center items-center h-48 relative">
                    <div id="traffic-light-container" class="absolute left-0 top-1/2 transform -translate-y-1/2 flex flex-col items-center">
                        <div id="traffic-light" class="traffic-light w-10 h-20 rounded-full light-yellow border-4 border-gray-600 flex items-center justify-center text-xl font-bold text-white shadow-inner">
                            ?
                        </div>
                        <p class="text-xs font-bold mt-1">score <span class="text-sm font-extrabold">‚â•</span> 70</p>
                    </div>

                    <div id="road-diverter" class="road-diverter absolute left-14 top-1/2 w-4 h-4 bg-gray-600 rounded-full transform -translate-y-1/2 z-10" style="transform: translateY(-50%) rotate(0deg);"></div>

                    <div id="pass-road" class="absolute left-16 top-10 w-2/3 h-12 bg-green-200 rounded-lg border-2 border-green-600 flex items-center px-4 font-bold text-green-800">
                        IF Road: status = "Pass"
                        <div id="pass-token" class="absolute left-0 w-3 h-3 bg-blue-600 rounded-full hidden"></div>
                    </div>

                    <div id="fail-road" class="absolute left-16 bottom-10 w-2/3 h-12 bg-red-200 rounded-lg border-2 border-red-600 flex items-center px-4 font-bold text-red-800">
                        ELSE Road: status = "Fail"
                        <div id="fail-token" class="absolute left-0 w-3 h-3 bg-blue-600 rounded-full hidden"></div>
                    </div>
                </div>

                <p id="sim-log" class="mt-4 p-2 bg-purple-100 rounded text-purple-700 font-semibold text-center"></p>
            </div>
        </div>

        <hr class="my-6 border-purple-300">

        <h3 class="text-xl font-bold mb-4 text-red-600">üö© The Trap: Missing Colon (:)</h3>
        
        <div class="grid grid-cols-3 gap-6 items-center">
            <div id="trap-display" class="bg-red-50 p-4 rounded-xl border-4 border-red-400 text-center relative min-h-[120px]">
                <p class="font-mono text-lg font-bold">if score <span class="font-extrabold">‚â•</span> 70</p>
                <div class="mt-3 text-red-700 font-bold text-2xl shake">SYNTAX ERROR!</div>
                <p class="text-red-700 mt-2">The colon is the **final lock** that connects the rule to the road!</p>
            </div>
            
            <div id="colon-drop-area" class="text-center p-4 border-dashed border-2 border-red-500 rounded-lg bg-white relative">
                <span id="missing-colon" class="text-5xl text-red-600 font-bold p-2 draggable-fix" draggable="true" data-fix="colon">:</span>
                <p class="mt-2 text-sm text-red-600 font-semibold">Drag the colon **:** to the end of the code to fix the lock!</p>
            </div>

            <div id="colon-fixed-code" class="bg-green-50 p-4 rounded-xl border-4 border-green-400 text-center relative min-h-[120px]">
                <p id="colon-code-display" class="font-mono text-lg font-bold">if score <span class="font-extrabold">‚â•</span> 70</p>
                <div id="colon-feedback" class="absolute inset-0 hidden items-center justify-center text-green-700 text-2xl font-black bg-green-900/10 rounded-xl">FIXED SIGNAL!</div>
                <div id="colon-ready-light" class="traffic-light w-10 h-10 rounded-full light-yellow border-4 border-gray-600 mx-auto mt-2"></div>
            </div>
        </div>

        <hr class="my-6 border-purple-300">

        <h3 class="text-xl font-bold mb-3 text-blue-600">7. Comparison Operators: Rule Check Detectives üìè</h3>

        <div class="grid grid-cols-3 gap-6">
            <div class="p-4 bg-yellow-50 rounded-lg border-2 border-yellow-400 text-center">
                <span class="operator-symbol text-4xl"> == </span><p class="font-bold">Balance Scale</p>
                <p class="text-sm">score == limit $\rightarrow$ <strong id="check1-result">True</strong></p>
                <div id="scale-equal" class="w-full h-10 bg-green-200 border-b-4 border-green-600 mt-2 flex items-center justify-center text-green-800 font-semibold">Balanced! (True)</div>
            </div>
            
            <div class="p-4 bg-red-50 rounded-lg border-2 border-red-400 text-center">
                <span class="operator-symbol text-4xl"> != </span><p class="font-bold">Broken Scale</p>
                <p class="text-sm">score != limit $\rightarrow$ <strong id="check2-result">False</strong></p>
                <div id="scale-not-equal" class="w-full h-10 bg-red-200 border-b-4 border-red-600 mt-2 flex items-center justify-center text-red-800 font-semibold">Unequal? (False)</div>
            </div>

            <div class="p-4 bg-gray-50 rounded-lg border-2 border-gray-400 text-center">
                <span class="operator-symbol text-4xl"> > </span><p class="font-bold">Digital Gauge</p>
                <p class="text-sm">score > limit $\rightarrow$ <strong id="check3-result">False</strong></p>
                <div id="gauge-greater" class="w-full h-10 bg-red-200 border-b-4 border-red-600 mt-2 flex items-center justify-center text-red-800 font-semibold">Not Higher (False)</div>
            </div>
        </div>

        <hr class="my-6 border-purple-300">

        <h3 class="text-xl font-bold mb-4 text-red-600">üö© The Trap: Assignment (=) vs. Comparison (==)</h3>

        <div class="grid grid-cols-3 gap-6 items-center">
            <div id="assignment-trap" class="bg-red-50 p-4 rounded-xl border-4 border-red-400 text-center relative min-h-[120px]">
                <p class="font-mono text-lg font-bold">if score = 70:</p>
                <div class="mt-3 text-red-700 font-bold text-2xl shake">CONFUSED!</div>
                <p class="text-red-700 mt-2">Trying to check a rule **AND** change a variable simultaneously!</p>
            </div>
            
            <div id="equal-drop-area" class="text-center p-4 border-dashed border-2 border-red-500 rounded-lg bg-white relative">
                <span id="missing-equal" class="text-5xl text-red-600 font-bold p-2 draggable-fix" draggable="true" data-fix="equal">=</span>
                <p class="mt-2 text-sm text-red-600 font-semibold">Drag the second **=** to create the Balance Scale!</p>
            </div>

            <div id="equal-fixed-code" class="bg-green-50 p-4 rounded-xl border-4 border-green-400 text-center relative min-h-[120px]">
                <p id="equal-code-display" class="font-mono text-lg font-bold">if score = 70:</p>
                <div id="equal-feedback" class="absolute inset-0 hidden items-center justify-center text-green-700 text-2xl font-black bg-green-900/10 rounded-xl">RULE CHECK ACTIVE!</div>
                <div id="balance-scale-viz" class="w-20 h-10 bg-yellow-200 border-b-4 border-yellow-600 mx-auto mt-2 hidden items-center justify-center text-sm font-bold">Balance Scale</div>
            </div>
        </div>

        <hr class="my-6 border-purple-300">

        <h3 class="text-xl font-bold mb-4 text-blue-600">üéÆ The Playground: Rule Designer Challenge</h3>

        <div class="grid grid-cols-2 gap-8">
            <div>
                <p class="font-bold text-lg mb-2 text-blue-800">üéØ Rule Goal: Allow traffic ONLY if the speed is **less than or equal to 60**.</p>
                
                <div class="p-4 bg-gray-100 rounded-lg mb-4">
                    <p class="font-bold mb-2">Select the Correct Operator:</p>
                    <select id="operator-select" class="w-full p-2 border-2 border-blue-400 rounded-lg text-lg font-mono">
                        <option value="none">--- Select Operator ---</option>
                        <option value="==">== (Equal)</option>
                        <option value="!=">!= (Not Equal)</option>
                        <option value=">">&gt; (Greater Than)</option>
                        <option value="<">&lt; (Less Than)</option>
                        <option value=">=">&gt;= (Greater or Equal)</option>
                        <option value="<=">&lt;= (Less or Equal)</option>
                    </select>
                </div>

                <div class="p-4 bg-yellow-100 rounded-lg">
                    <p class="font-bold mb-2">Variables in Check:</p>
                    <label for="speed-slider" class="block">Current Speed: <span id="speed-value">55</span></label>
                    <input type="range" id="speed-slider" min="10" max="100" value="55" class="slider-input">
                    
                    <label for="limit-input" class="block mt-2">Speed Limit: 60</label>
                </div>
            </div>

            <div class="bg-blue-50 p-4 rounded-lg border-2 border-blue-400">
                <button onclick="runRuleDesignerChallenge()" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 mb-4">
                    Run Rule Check! üìè
                </button>
                
                <div class="bg-gray-800 p-4 rounded-lg text-green-400 font-mono text-lg text-center">
                    <p>if current_speed <span id="op-display">?</span> limit:</p>
                    <p>Result: <span id="check-result-display" class="text-xl">?</span></p>
                </div>
                
                <div class="mt-4 flex flex-col items-center">
                    <div id="rule-traffic-light" class="traffic-light w-12 h-12 rounded-full light-yellow border-4 border-gray-600"></div>
                    <div id="rule-car-message" class="mt-2 text-center font-bold"></div>
                </div>
            </div>
        </div>
    </section>

    <script>
        // --- 4. Section 3: Division Fix Logic ---
        const missingSlash = document.getElementById('missing-slash');
        const fixCodeDisplay = document.getElementById('fix-code-display');
        const intResult = document.getElementById('int-result');
        const qualityBadge = document.getElementById('quality-badge');
        const fixedCodeContainer = document.getElementById('fixed-code-container');
        let fixApplied = false;

        missingSlash.addEventListener('dragstart', (e) => {
            e.dataTransfer.setData("text/fix", e.target.getAttribute('data-fix'));
            e.dataTransfer.effectAllowed = "move";
        });

        fixedCodeContainer.addEventListener('dragover', (e) => {
            e.preventDefault();
            fixedCodeContainer.style.backgroundColor = '#bbf7d0'; // green-200
        });

        fixedCodeContainer.addEventListener('dragleave', (e) => {
            fixedCodeContainer.style.backgroundColor = ''; 
        });

        fixedCodeContainer.addEventListener('drop', (e) => {
            e.preventDefault();
            fixedCodeContainer.style.backgroundColor = '';

            if (fixApplied) return;

            const fix = e.dataTransfer.getData("text/fix");
            if (fix === 'slash') {
                fixCodeDisplay.innerHTML = 'clean_result = 10 <span class="text-green-600">//</span> 3';
                intResult.textContent = '3';
                intResult.classList.remove('is-float');
                intResult.classList.add('is-int');
                qualityBadge.classList.remove('hidden');
                qualityBadge.classList.add('flex');
                missingSlash.style.opacity = 0.3;
                fixApplied = true;
            }
        });

        // --- 5. Section 4: Power Stack Challenge Logic ---
        function runPowerStackChallenge() {
            const input = document.getElementById('power-input').value.trim();
            const resultBlock = document.getElementById('result-block');
            const powerMessage = document.getElementById('power-message');
            
            // Regex to find Base ** Exp
            const match = input.match(/(\d+)\s*\*\*\s*(\d+)/); 
            
            resultBlock.className = 'w-24 h-24 border-4 flex items-center justify-center text-3xl font-black rounded-lg shadow-2xl speaking';

            if (!match) {
                powerMessage.textContent = "Error! Use the format: BASE ** EXP (e.g., 5 ** 3)";
                resultBlock.className = 'w-24 h-24 bg-red-400 border-4 border-red-600 flex items-center justify-center text-3xl font-black rounded-lg shadow-2xl';
                resultBlock.textContent = 'Err';
                return;
            }

            const base = parseInt(match[1]);
            const exp = parseInt(match[2]);
            let result = Math.pow(base, exp);

            if (base === 5 && exp === 3) {
                // Correct logic
                resultBlock.className = 'w-24 h-24 bg-yellow-400 border-4 border-yellow-600 flex items-center justify-center text-3xl font-black rounded-lg shadow-2xl';
                resultBlock.textContent = result;
                powerMessage.textContent = "**PRODUCTION GOAL ACHIEVED!** Block 125 created successfully!";
            } else if (input.includes('*') && !input.includes('**')) {
                 // Wrong operator * instead of **
                resultBlock.className = 'w-24 h-24 bg-red-400 border-4 border-red-600 flex items-center justify-center text-3xl font-black rounded-lg shadow-2xl';
                resultBlock.textContent = base * exp;
                powerMessage.textContent = "Wrong Operator! That's the Replication Stamper (*), not the Power Stack (**)!";
            } else {
                // Wrong numbers
                resultBlock.className = 'w-24 h-24 bg-red-400 border-4 border-red-600 flex items-center justify-center text-3xl font-black rounded-lg shadow-2xl';
                resultBlock.textContent = result;
                powerMessage.textContent = `Incorrect result block (${result}). Use 5 and 3!`;
            }

            setTimeout(() => resultBlock.classList.remove('speaking'), 300);
        }

        // --- 5. Section 3: int() Fix Logic ---
        const dropTargets = document.querySelectorAll('.drop-target');
        const intFilters = document.querySelectorAll('.draggable-fix[data-fix="int"]');
        const fixStatus = document.getElementById('fix-status');
        let filtersPlaced = 0;

        intFilters.forEach(filter => {
            filter.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData("text/filter", e.target.textContent);
            });
        });

        dropTargets.forEach(target => {
            target.addEventListener('dragover', (e) => {
                e.preventDefault();
                target.classList.add('bg-blue-800/50');
            });

            target.addEventListener('dragleave', (e) => {
                target.classList.remove('bg-blue-800/50');
            });

            target.addEventListener('drop', (e) => {
                e.preventDefault();
                target.classList.remove('bg-blue-800/50');

                const filterText = e.dataTransfer.getData("text/filter");
                if (filterText === 'int()' && !target.classList.contains('fixed')) {
                    // Visually wrap the variable name
                    target.innerHTML = `<span class="text-green-400">int(</span>${target.getAttribute('data-variable')}<span class="text-green-400">)</span>`;
                    target.classList.remove('bg-red-800/50', 'text-white');
                    target.classList.add('fixed');
                    filtersPlaced++;

                    if (filtersPlaced === 2) {
                        fixStatus.textContent = "**DATA FLOW OPTIMAL!** Conversion fixed. Math Processor is ready.";
                        fixStatus.classList.remove('text-red-600');
                        fixStatus.classList.add('text-green-600');
                    } else {
                        fixStatus.textContent = `One filter placed. Place the remaining filter!`;
                    }
                }
            });
        });


        // --- 6. If-Else Simulation Logic ---
        const trafficLight = document.getElementById('traffic-light');
        const roadDiverter = document.getElementById('road-diverter');
        const failRoad = document.getElementById('fail-road');
        const passToken = document.getElementById('pass-token');
        const simLog = document.getElementById('sim-log');
        const statusElement = document.getElementById('sim-status');

        const simLines = [
            document.getElementById('sim-line-1'),
            document.getElementById('sim-line-2'),
            document.getElementById('sim-line-3'),
            document.getElementById('sim-line-4'),
            document.getElementById('sim-line-5'),
            document.getElementById('sim-line-6')
        ];

        const delay = ms => new Promise(r => setTimeout(r, ms));

        async function runIfElseSimulation() {
            // Reset
            statusElement.textContent = 'Empty';
            statusElement.className = 'text-xl text-red-600';
            trafficLight.className = 'traffic-light w-10 h-20 rounded-full light-yellow border-4 border-gray-600 flex items-center justify-center text-xl font-bold text-white shadow-inner';
            roadDiverter.style.transform = 'translateY(-50%) rotate(0deg)'; // Neutral position
            failRoad.classList.remove('road-blocked');
            passToken.classList.add('hidden');
            passToken.style.transform = 'translateX(0)';
            simLog.textContent = 'Simulation started...';
            simLines.forEach(line => line.classList.remove('bg-yellow-200', 'bg-opacity-20'));

            // Step 1: score = 85
            simLines[0].classList.add('bg-yellow-200', 'bg-opacity-20');
            simLog.textContent = 'Step 1: Variable **score** is set to 85.';
            await delay(1000);
            simLines[0].classList.remove('bg-yellow-200', 'bg-opacity-20');

            // Step 2: if score >= 70:
            simLines[1].classList.add('bg-yellow-200', 'bg-opacity-20');
            simLog.textContent = 'Step 2: Checking condition (85 ‚â• 70) -> **True**!';
            await delay(500);
            
            // Animation: Light turns Green, Diverter moves
            trafficLight.classList.remove('light-yellow');
            trafficLight.classList.add('light-green');
            trafficLight.textContent = 'T'; // True
            roadDiverter.style.transform = 'translateY(-50%) rotate(-30deg)'; // Opens Pass, Blocks Fail
            failRoad.classList.add('road-blocked');
            await delay(1000);
            simLines[1].classList.remove('bg-yellow-200', 'bg-opacity-20');

            // Step 3: status = "Pass"
            simLines[2].classList.add('bg-yellow-200', 'bg-opacity-20');
            simLog.textContent = 'Step 3: Execution flows down the **IF road**. status = "Pass".';
            
            // Animation: Token drives down Pass Road
            passToken.classList.remove('hidden');
            passToken.classList.add('token-flow');
            
            statusElement.textContent = 'Pass';
            statusElement.className = 'text-xl text-green-600';
            await delay(1500);
            passToken.classList.remove('token-flow');
            passToken.classList.add('hidden');
            passToken.style.transform = 'translateX(0)';
            simLines[2].classList.remove('bg-yellow-200', 'bg-opacity-20');

            // Step 4: else: (Skip)
            simLines[3].classList.add('bg-yellow-200', 'bg-opacity-20');
            simLog.textContent = 'Step 4: Skipping **ELSE** road. Only one path can execute.';
            await delay(1000);
            simLines[3].classList.remove('bg-yellow-200', 'bg-opacity-20');

            // Step 6: print(status)
            simLines[5].classList.add('bg-yellow-200', 'bg-opacity-20');
            simLog.textContent = 'Step 5: Program finishes and prints "Pass".';
            await delay(1000);
            simLines[5].classList.remove('bg-yellow-200', 'bg-opacity-20');

            trafficLight.classList.remove('light-green');
            trafficLight.classList.add('light-yellow');
            trafficLight.textContent = '?';
            roadDiverter.style.transform = 'translateY(-50%) rotate(0deg)';
            failRoad.classList.remove('road-blocked');
        }

        // --- 6. Section 3: Colon Fix Logic ---
        const missingColon = document.getElementById('missing-colon');
        const colonFixedCode = document.getElementById('colon-fixed-code');
        let colonFixed = false;

        missingColon.addEventListener('dragstart', (e) => {
            e.dataTransfer.setData("text/fix", e.target.getAttribute('data-fix'));
            e.dataTransfer.effectAllowed = "move";
        });

        colonFixedCode.addEventListener('dragover', (e) => { e.preventDefault(); });
        colonFixedCode.addEventListener('drop', (e) => {
            e.preventDefault();
            if (colonFixed) return;

            const fix = e.dataTransfer.getData("text/fix");
            if (fix === 'colon') {
                document.getElementById('colon-code-display').innerHTML = 'if score <span class="font-extrabold">‚â•</span> 70<strong class="text-green-600">:</strong>';
                document.getElementById('trap-display').classList.remove('shake');
                document.getElementById('trap-display').querySelector('.text-2xl').textContent = 'Fixed!';

                document.getElementById('colon-feedback').classList.remove('hidden');
                document.getElementById('colon-feedback').classList.add('flex');
                
                // Traffic light animation: Yellow -> Green
                document.getElementById('colon-ready-light').classList.remove('light-yellow');
                document.getElementById('colon-ready-light').classList.add('light-green');
                
                missingColon.style.opacity = 0.3;
                colonFixed = true;
            }
        });

        // --- 7. Section 3: Assignment Fix Logic ---
        const missingEqual = document.getElementById('missing-equal');
        const equalFixedCode = document.getElementById('equal-fixed-code');
        let equalFixed = false;

        missingEqual.addEventListener('dragstart', (e) => {
            e.dataTransfer.setData("text/fix", e.target.getAttribute('data-fix'));
            e.dataTransfer.effectAllowed = "move";
        });

        equalFixedCode.addEventListener('dragover', (e) => { e.preventDefault(); });
        equalFixedCode.addEventListener('drop', (e) => {
            e.preventDefault();
            if (equalFixed) return;

            const fix = e.dataTransfer.getData("text/fix");
            if (fix === 'equal') {
                document.getElementById('equal-code-display').innerHTML = 'if score <strong class="text-green-600">==</strong> 70:';
                document.getElementById('assignment-trap').classList.remove('shake');
                document.getElementById('assignment-trap').querySelector('.text-2xl').textContent = 'Fixed!';

                document.getElementById('equal-feedback').classList.remove('hidden');
                document.getElementById('equal-feedback').classList.add('flex');
                
                document.getElementById('balance-scale-viz').classList.remove('hidden');
                document.getElementById('balance-scale-viz').classList.add('flex');
                
                missingEqual.style.opacity = 0.3;
                equalFixed = true;
            }
        });

        // --- 7. Section 4: Rule Designer Challenge Logic ---
        const opSelect = document.getElementById('operator-select');
        const speedSlider = document.getElementById('speed-slider');
        const speedValueSpan = document.getElementById('speed-value');
        const opDisplay = document.getElementById('op-display');
        const checkResultDisplay = document.getElementById('check-result-display');
        const ruleTrafficLight = document.getElementById('rule-traffic-light');
        const ruleCarMessage = document.getElementById('rule-car-message');
        
        speedSlider.addEventListener('input', () => {
            speedValueSpan.textContent = speedSlider.value;
        });

        opSelect.addEventListener('change', () => {
            opDisplay.textContent = opSelect.value === 'none' ? '?' : opSelect.value;
        });

        function runRuleDesignerChallenge() {
            const selectedOp = opSelect.value;
            const speed = parseInt(speedSlider.value);
            const limit = 60;
            let result = false;

            if (selectedOp === 'none') {
                 ruleCarMessage.textContent = 'Please select an operator!';
                 return;
            }
            
            // The logic check
            switch (selectedOp) {
                case '==': result = speed == limit; break;
                case '!=': result = speed != limit; break;
                case '>': result = speed > limit; break;
                case '<': result = speed < limit; break;
                case '>=': result = speed >= limit; break;
                case '<=': result = speed <= limit; break;
            }

            checkResultDisplay.textContent = result ? 'True' : 'False';
            ruleTrafficLight.classList.remove('light-green', 'light-red', 'light-yellow');
            
            const isCorrectRule = selectedOp === '<=';
            
            if (isCorrectRule && result === true) {
                // Correct operator and result (Speed 55 <= 60 is True)
                ruleTrafficLight.classList.add('light-green');
                ruleCarMessage.textContent = `Rule ${speed} ${selectedOp} ${limit} is **True!** Car drives past. (Correct Operator)`;
            } else if (isCorrectRule && result === false) {
                 // Correct operator, but speed is too high (Speed 65 <= 60 is False)
                ruleTrafficLight.classList.add('light-red');
                ruleCarMessage.textContent = `Rule ${speed} ${selectedOp} ${limit} is **False!** Car stops.`;
            } else if (!isCorrectRule && result === true) {
                // Wrong operator, but result is True (e.g., Speed 65 > 60 is True - we want to fail the user on the operator selection)
                ruleTrafficLight.classList.add('light-red');
                ruleCarMessage.textContent = `‚ùå **Wrong Operator!** You chose ${selectedOp}. The rule should use **<=**`;
            } else {
                ruleTrafficLight.classList.add('light-red');
                ruleCarMessage.textContent = `‚ùå **Wrong Operator** or Result! The rule is "less than or equal to".`;
            }
        }
    </script>
</body>
</html>
