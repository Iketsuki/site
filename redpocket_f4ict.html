<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Âà©ÊòØ Anki - üßßÁü•Ë≠òË≤°ÂØå</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$']] },
            svg: { fontCache: 'global' }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+HK:wght@700&display=swap');

        body {
            background-color: #fff5f5;
            font-family: system-ui, -apple-system, sans-serif;
            overflow: hidden;
            height: 100vh;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            perspective: 1200px;
        }

        .lucky-font { font-family: 'Noto Serif HK', serif; }

        .envelope-box {
            position: relative;
            width: 240px;
            height: 340px;
            background: linear-gradient(145deg, #e63946, #b91c1c);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 20;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .paper-slip {
            position: absolute;
            width: 210px;
            height: 300px;
            z-index: 10;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
            cursor: pointer;
        }

        .is-open .paper-slip { transform: translateY(-240px); }

        .is-zoomed .paper-slip {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            transform: none;
            z-index: 100;
        }

        .paper-slip.flipped { transform: translateY(-240px) rotateY(180deg); }
        .is-zoomed .paper-slip.flipped { transform: rotateY(180deg); }

        .card-face {
            position: absolute;
            inset: 0;
            background: #fffdf5;
            padding: 20px;
            display: flex;
            flex-direction: column;
            backface-visibility: hidden;
            box-sizing: border-box;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .is-zoomed .card-face { padding: 40px 20px; box-shadow: none; }
        .card-face.back { transform: rotateY(180deg); }

        .close-zoom {
            display: none;
            position: absolute;
            top: 20px;
            right: 20px;
            background: #b91c1c;
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            z-index: 120;
        }
        .is-zoomed .close-zoom { display: flex; }

        .content-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow-y: auto;
        }

        /* Timer UI Styles */
        .timer-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            flex-shrink: 0;
        }
        
        .timer-circle {
            width: 24px;
            height: 24px;
            transform: rotate(-90deg);
        }

        .timer-circle circle {
            fill: none;
            stroke-width: 3;
            stroke-linecap: round;
        }

        .timer-bg { stroke: #fee2e2; }
        .timer-progress {
            stroke: #b91c1c;
            stroke-dasharray: 63; /* 2 * PI * r(10) */
            stroke-dashoffset: 63;
            transition: stroke-dashoffset 1s linear;
        }

        .flip-hint {
            font-size: 0.7rem;
            color: #991b1b;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            opacity: 0.8;
            font-weight: bold;
        }

        .is-zoomed #math-text, .is-zoomed #answer-text { font-size: 1.25rem; }
        .is-zoomed #math-latex, .is-zoomed #answer-latex { font-size: 1.6rem; }

        .footer {
            margin-top: 8px;
            padding-top: 12px;
            border-top: 1px solid #fecaca;
            flex-shrink: 0;
        }
    </style>
</head>
<body>

    <div id="app-container" class="relative">
        
        <div id="paper" class="paper-slip" onclick="handlePaperClick(event)">
            
            <!-- Front Face: Question -->
            <div class="card-face front">
                <div class="close-zoom" onclick="closeZoom(event)">‚úï</div>
                
                <div class="timer-container">
                    <svg class="timer-circle">
                        <circle class="timer-bg" cx="12" cy="12" r="10"></circle>
                        <circle id="timer-bar" class="timer-progress" cx="12" cy="12" r="10"></circle>
                    </svg>
                    <div id="hint-text" class="flip-hint">Open to Start</div>
                </div>

                <div class="content-area">
                    <p id="math-text" class="text-gray-600 mb-2"></p>
                    <div id="math-latex" class="text-gray-900"></div>
                </div>
                <div class="footer">
                    <p id="blessing-display" class="lucky-font text-red-700 text-sm"></p>
                </div>
            </div>

            <!-- Back Face: Answer -->
            <div class="card-face back">
                <div class="flip-hint" style="margin-bottom: 8px;">Answer</div>
                <div class="content-area">
                    <p id="answer-text" class="text-gray-500 mb-2"></p>
                    <div id="answer-latex" class="text-gray-900 font-bold text-red-800"></div>
                </div>
                <div class="footer">
                    <p id="blessing-display-back" class="lucky-font text-red-700 text-sm"></p>
                </div>
            </div>
        </div>

        <div id="envelope" class="envelope-box" onclick="openEnvelope()">
            <div class="lucky-font text-yellow-400 text-6xl mb-4">Á¶è</div>
            <div class="w-16 h-16 rounded-full bg-yellow-500 border-4 border-red-800 flex items-center justify-center text-red-800 font-bold shadow-inner text-2xl">Âêâ</div>
            <p class="absolute bottom-6 text-yellow-400/50 lucky-font text-xs tracking-widest uppercase">ÈªûÊìäÊãÜÂà©ÊòØ</p>
        </div>

    </div>

    <script>
    
        const problemSet = [
            { 
                text: "Let $a$, $b$ and $c$ be non-zero numbers such that $\\frac{a}{b} = \\frac{2}{3}$ and $5a = 2c$. Find", 
                latex: "$$\\frac{a+3b}{b+6c}$$", 
                ansText: "Result:", 
                ansLatex: "$$\\frac{11}{13}$$" 
            },
            { 
                text: "A cyclist travels from town $A$ to town $B$ at an average speed of 20 km/h and then he travels from town $B$ to town $C$ at an average speed of 24 km/h. It is given that the cyclist travels 28 km in 75 minutes for the whole journey. How long does the cyclist take to travel from town $A$ to town $B$?", 
                latex: "", 
                ansText: "Answer:", 
                ansLatex: "30 minutes" 
            },
            { 
                text: "In a library, the ratio of the number of male readers to the number of female readers is $4 : 5$. If 14 male readers and 22 female readers enter the library, then the ratio of the number of male readers to the number of female readers is $3 : 4$. Find the original number of female readers in the library.", 
                latex: "", 
                ansText: "Answer:", 
                ansLatex: "50" 
            },
            { 
                text: "Factorize:", 
                latex: "(a) $p^2 - 9q^2$, (b) $p^2 - 9q^2 + 5p - 15q$", 
                ansText: "Answer:", 
                ansLatex: "(a) $(p-3q)(p+3q)$, (b) $(p-3q)(p+3q+5)$" 
            },
            { 
                text: "Factorize:", 
                latex: "(a) $m^3 + m^2n + 4m^2$, (b) $m^3 + m^2n + 4m^2 - m - n - 4$", 
                ansText: "Answer:", 
                ansLatex: "(a) $m^2(m+n+4)$, (b) $(m-1)(m+1)(m+n+4)$" 
            },
            { 
                text: "Factorize:", 
                latex: "(a) $2a + 8b$, (b) $a^2 + ab - 12b^2$, (c) $2a + 8b + a^2 + ab - 12b^2$", 
                ansText: "Answer:", 
                ansLatex: "(a) $2(a+4b)$, (b) $(a+4b)(a-3b)$, (c) $(a+4b)(a-3b+2)$" 
            },
            { 
                text: "Make $q$ the subject of the formula", 
                latex: "$$\\frac{2q-3}{p} = 5$$", 
                ansText: "Answer:", 
                ansLatex: "$$q = \\frac{5p+3}{2}$$" 
            },
            { 
                text: "Make $p$ the subject of the formula", 
                latex: "$$9(p + 8q) = 5p + 4$$", 
                ansText: "Answer:", 
                ansLatex: "$$p = 1 - 18q$$" 
            },
            { 
                text: "Make $y$ the subject of the formula", 
                latex: "$$\\frac{x}{2} = \\frac{y+4}{3}$$", 
                ansText: "Answer:", 
                ansLatex: "$$y = \\frac{3x-8}{2}$$" 
            },
            { 
                text: "Make $b$ the subject of the formula", 
                latex: "$$\\frac{4}{a} - \\frac{3}{b} = 1$$", 
                ansText: "Answer:", 
                ansLatex: "$$b = \\frac{3a}{4-a}$$" 
            },
            { 
                text: "Consider the formula $u + 12v = 3(8 - u)$. (a) Make $u$ the subject of the above formula. (b) If the value of $v$ is decreased by 3, write down the change in the value of $u$.", 
                latex: "", 
                ansText: "Answer:", 
                ansLatex: "(a) $u = 6 - 3v$, (b) Increased by 9" 
            },
            { 
                text: "Simplify", 
                latex: "$$\\frac{1}{x+1} - \\frac{6}{6x-1}$$", 
                ansText: "Answer:", 
                ansLatex: "$$\\frac{-7}{(x+1)(6x-1)}$$" 
            }
        ];


        const blessingMessages = [
            "ÂçöÂ≠∏ÂØ©ÂïèÔºåÊÖéÊÄùÊòéËæ®",
            "ÈùíÂá∫ÊñºËóçÔºåËÄåÂãùÊñºËóç",
            "Êõ∏Â±±ÊúâË∑ØÂã§ÁÇ∫Âæë",
            "Ê∫´ÊïÖËÄåÁü•Êñ∞",
            "ÁôæÂ∞∫Á´øÈ†≠ÔºåÊõ¥ÈÄ≤‰∏ÄÊ≠•",
            "Â≠∏ËÄå‰∏çÂé≠ÔºåË™®‰∫∫‰∏çÂÄ¶",
            "Â§ßÂêâÂ§ßÂà©ÔºåÂ≠∏Ê•≠ÈÄ≤Ê≠•",
            "Êï¨ÁïèËÄ∂ÂíåËèØÊòØÊô∫ÊÖßÁöÑÈñãÁ´ØÔºõÂá°ÈÅµË°å‰ªñÂëΩ‰ª§ÁöÑÊòØËÅ∞Êòé‰∫∫„ÄÇ(Ë©©ÁØá 111:10)",
            "‰Ω†Ë¶ÅÂ∞àÂøÉ‰ª∞Ë≥¥ËÄ∂ÂíåËèØÔºå‰∏çÂèØÂÄöÈù†Ëá™Â∑±ÁöÑËÅ∞Êòé„ÄÇ(ÁÆ¥Ë®Ä 3:5)",
            "Êô∫ÊÖßÂøÖÂÖ•‰Ω†ÂøÉÔºõ‰Ω†ÁöÑÈùàË¶Å‰ª•Áü•Ë≠òÁÇ∫Áæé„ÄÇ(ÁÆ¥Ë®Ä 2:10)",
            "ÊÇ£Èõ£ÁîüÂøçËÄêÔºåÂøçËÄêÁîüËÄÅÁ∑¥ÔºåËÄÅÁ∑¥ÁîüÁõºÊúõ„ÄÇ(ÁæÖÈ¶¨Êõ∏ 5:3-4)",
            "‰Ω†ÂÄë‰∏≠ÈñìËã•ÊúâÁº∫Â∞ëÊô∫ÊÖßÁöÑÔºåÊáâÁï∂Ê±ÇÈÇ£ÂéöË≥úËàáÁúæ‰∫∫„ÄÅ‰πü‰∏çÊñ•Ë≤¨‰∫∫ÁöÑÁ•ûÔºå‰∏ªÂ∞±ÂøÖË≥úÁµ¶‰ªñ„ÄÇ(ÈõÖÂêÑÊõ∏ 1:5)",
            "ÊïôÂ∞éÊô∫ÊÖß‰∫∫Ôºå‰ªñÂ∞±Ë∂äÁôºÊúâÊô∫ÊÖßÔºõÊåáÁ§∫Áæ©‰∫∫Ôºå‰ªñÂ∞±Â¢ûÈï∑Â≠∏Âïè„ÄÇ(ÁÆ¥Ë®Ä 9:9)",
            "‰ΩÜÈÇ£Á≠âÂÄôËÄ∂ÂíåËèØÁöÑÂøÖÂæûÊñ∞ÂæóÂäõ„ÄÇ‰ªñÂÄëÂøÖÂ¶ÇÈ∑πÂ±ïÁøÖ‰∏äÈ®∞Ôºõ‰ªñÂÄëÂ•îË∑ëÂçª‰∏çÂõ∞ÂÄ¶„ÄÇ(‰ª•Ë≥Ω‰∫ûÊõ∏ 40:31)",
            "ÂæóÊô∫ÊÖßÔºåÂæóËÅ∞ÊòéÁöÑÔºåÈÄô‰∫∫‰æøÁÇ∫ÊúâÁ¶è„ÄÇ(ÁÆ¥Ë®Ä 3:13)",
            "ÂÅ¥ËÄ≥ËÅΩÊô∫ÊÖßÔºåÂ∞àÂøÉÊ±ÇËÅ∞Êòé„ÄÇ(ÁÆ¥Ë®Ä 2:2)",
            "Êô∫ÊÖß‰∫∫Â§ßÂ§ßËÉΩÂäõÔºõÊúâÁü•Ë≠òÁöÑ‰∫∫Âäõ‰∏äÂä†Âäõ„ÄÇ(ÁÆ¥Ë®Ä 24:5)",
            "‰Ω†ÂÄëË¶ÅÂø´Âø´ÁöÑËÅΩÔºåÊÖ¢ÊÖ¢ÁöÑË™™ÔºåÊÖ¢ÊÖ¢ÁöÑÂãïÊÄí„ÄÇ(ÈõÖÂêÑÊõ∏ 1:19)",
            "ËÅ∞Êòé‰∫∫ÁöÑÂøÉÂæóÁü•Ë≠òÔºåÊô∫ÊÖß‰∫∫ÁöÑËÄ≥Ê±ÇÁü•Ë≠ò„ÄÇ(ÁÆ¥Ë®Ä 18:15)"
        ];

        let state = 'closed';
        let timeLeft = 60;
        let timerId = null;
        let canFlip = false;

        function openEnvelope() {
            if (state !== 'closed') return;
            
            const problem = problemSet[Math.floor(Math.random() * problemSet.length)];
            document.getElementById('math-text').innerText = problem.text;
            document.getElementById('math-latex').innerHTML = problem.latex;
            document.getElementById('answer-text').innerText = problem.ansText;
            document.getElementById('answer-latex').innerHTML = problem.ansLatex;

            const blessing = blessingMessages[Math.floor(Math.random() * blessingMessages.length)];
            document.getElementById('blessing-display').innerText = blessing;
            document.getElementById('blessing-display-back').innerText = blessing;

            if (window.MathJax) MathJax.typesetPromise();

            document.getElementById('app-container').classList.add('is-open');
            document.getElementById('hint-text').innerText = "Tap to Zoom & Solve";
            state = 'open';
        }

        function startTimer() {
            if (timerId) return;
            timeRequired = 60; // 60 seconds to solve
            timeLeft = timeRequired;
            canFlip = false;
            const bar = document.getElementById('timer-bar');
            const hint = document.getElementById('hint-text');
            
            hint.innerText = `Calculate now... ${timeLeft}s left to check the final answer`;
            
            timerId = setInterval(() => {
                timeLeft--;
                const offset = 63 - (63 * (timeRequired - timeLeft) / timeRequired);
                bar.style.strokeDashoffset = offset;
                
                if (timeLeft > 0) {
                    hint.innerText = `Calculate now... ${timeLeft}s left to check the final answer`;
                } else {
                    clearInterval(timerId);
                    timerId = null;
                    canFlip = true;
                    hint.innerText = "READY! Tap to reveal and check your answer";
                    hint.classList.add('animate-pulse');
                    bar.style.stroke = "#10b981"; // Change to green
                }
            }, 1000);
        }

        function handlePaperClick(event) {
            if (event.target.closest('.close-zoom')) return;

            const paper = document.getElementById('paper');
            const container = document.getElementById('app-container');

            if (state === 'open') {
                container.classList.add('is-zoomed');
                state = 'zoomed';
                startTimer();
            } else if (state === 'zoomed' && canFlip) {
                paper.classList.toggle('flipped');
            } else if (state === 'zoomed' && !canFlip) {
                // Visual feedback that we are waiting
                const hint = document.getElementById('hint-text');
                hint.classList.add('scale-110', 'text-red-500');
                setTimeout(() => hint.classList.remove('scale-110', 'text-red-500'), 200);
            }
        }

        function closeZoom(event) {
            event.stopPropagation();
            clearInterval(timerId);
            timerId = null;
            
            const paper = document.getElementById('paper');
            const container = document.getElementById('app-container');
            const bar = document.getElementById('timer-bar');
            const hint = document.getElementById('hint-text');
            
            container.classList.remove('is-zoomed', 'is-open');
            paper.classList.remove('flipped');
            hint.classList.remove('animate-pulse');
            bar.style.strokeDashoffset = 63;
            bar.style.stroke = "#b91c1c";
            
            state = 'closed';
        }
    </script>
</body>
</html>