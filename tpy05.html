<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Math: Arithmetic Operators üìê</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        /* Custom Font */
        body { font-family: 'Inter', sans-serif; }

        /* Factory Machine Styling */
        .machine {
            padding: 1rem;
            border-radius: 0.5rem;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
            height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        .machine:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }
        .machine-icon {
            font-size: 2rem;
            line-height: 1;
        }
        .operator {
            font-family: monospace;
            font-weight: bold;
            font-size: 1.25rem;
        }

        /* Block Styles (Input/Output) */
        .number-block {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 40px;
            height: 40px;
            background-color: #34d399; /* Emerald */
            color: #1f2937; /* Gray-800 */
            border: 2px solid #059669;
            border-radius: 6px;
            font-weight: bold;
            font-size: 1rem;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
            transition: all 0.5s;
        }
        .float-residue {
            box-shadow: 0 0 15px 5px rgba(59, 130, 246, 0.7); /* Blue Glow */
            border-color: #3b82f6;
            background-color: #93c5fd;
        }
        .remainder-piece {
            background-color: #fca5a5; /* Red-300 */
            border-color: #ef4444;
        }

        /* Simulation Tracing */
        .trace-line {
            transition: background-color 0.3s;
        }
        .active-trace {
            background-color: #fffbeb !important;
        }
        .sound-effect {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translate(-50%, -100%);
            padding: 0.25rem 0.5rem;
            background-color: #fcd34d;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            font-weight: bold;
            opacity: 0;
            animation: popUpFade 1.5s ease-out forwards;
        }
        @keyframes popUpFade {
            0% { opacity: 1; transform: translate(-50%, -100%); }
            100% { opacity: 0; transform: translate(-50%, -150%); }
        }

        /* Trap Fix Drag and Drop */
        .slash-icon {
            font-size: 2rem;
            font-weight: bold;
            cursor: grab;
            background-color: #fef08a;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            border: 1px solid #fde047;
            display: inline-block;
            transition: all 0.1s;
        }
        .drop-target {
            padding: 0 0.25rem;
            border: 2px dashed #f472b6;
            min-width: 10px;
            display: inline-block;
            border-radius: 3px;
        }
        .shake {
            animation: shake 0.5s;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-700 p-8">

    <header class="max-w-6xl mx-auto mb-12">
        <div class="p-6 bg-purple-700 text-white rounded-xl shadow-lg">
            <h1 class="text-3xl font-extrabold">üìê Python Math: Arithmetic Operators</h1>
            <p class="text-purple-200">Blueprint 4: The Math Processor Factory ‚öôÔ∏è</p>
        </div>
        
        <div class="mt-4 relative">
            <div class="absolute w-20 h-20 -top-4 rounded-full border-4 border-white shadow-xl bg-purple-100 p-1 z-10 flex items-center justify-center text-4xl">
                 ü§ñ
            </div>
            <div class="ml-24 p-4 bg-white rounded-2xl shadow-md border-2 border-purple-300 transition-all duration-300">
                <p class="font-semibold text-purple-800">
                    "Welcome to the Math Factory! We use powerful machines, called Operators ($+, -, *, /, //, \%, **$), to transform raw number blocks into calculated results. Watch how each machine performs a unique mathematical job!"
                </p>
            </div>
        </div>
    </header>

    ---

    <section id="hook" class="max-w-6xl mx-auto mb-12 bg-white rounded-xl shadow-lg border-2 border-purple-300 p-6">
        <h2 class="text-2xl font-bold mb-6 text-purple-700">1. ü™ù The Hook: Specialized Factory Machines</h2>
        <p class="mb-6">Arithmetic Operators are specialized machines in the Math Processor Factory. They take number blocks as input and transform them into a new result block.</p>
        
        <div class="grid grid-cols-3 gap-6">
            <div class="machine bg-green-100 border-2 border-green-300">
                <span class="machine-icon">‚ûï</span>
                <p class="operator text-green-700 font-bold">+ (Addition)</p>
                <p class="text-xs text-center text-green-800">The Fusion Press: Combines blocks.</p>
            </div>
            <div class="machine bg-red-100 border-2 border-red-300">
                <span class="machine-icon">‚ûñ</span>
                <p class="operator text-red-700 font-bold">- (Subtraction)</p>
                <p class="text-xs text-center text-red-800">The Abrasive Cutter: Removes an amount.</p>
            </div>
            <div class="machine bg-yellow-100 border-2 border-yellow-300">
                <span class="machine-icon">‚úñÔ∏è</span>
                <p class="operator text-yellow-700 font-bold">* (Multiplication)</p>
                <p class="text-xs text-center text-yellow-800">The Replication Stamper: Stamps out duplicates.</p>
            </div>
            <div class="machine bg-blue-100 border-2 border-blue-300">
                <span class="machine-icon">‚ûó</span>
                <p class="operator text-blue-700 font-bold">/ (Division)</p>
                <p class="text-xs text-center text-blue-800">The Fluid Dispenser: Splits blocks into decimal parts (float).</p>
            </div>
            <div class="machine bg-orange-100 border-2 border-orange-300">
                <span class="machine-icon">‚úÇÔ∏è</span>
                <p class="operator text-orange-700 font-bold">// (Floor Division)</p>
                <p class="text-xs text-center text-orange-800">The Whole Number Splitter: Splits into whole pieces (discards remainder).</p>
            </div>
            <div class="machine bg-pink-100 border-2 border-pink-300">
                <span class="machine-icon">üì¶</span>
                <p class="operator text-pink-700 font-bold">% (Modulo)</p>
                <p class="text-xs text-center text-pink-800">The Remainder Isolator: Captures the small leftover piece.</p>
            </div>
            <div class="machine bg-purple-100 border-2 border-purple-300 col-span-3 w-1/3 mx-auto">
                <span class="machine-icon">üöÄ</span>
                <p class="operator text-purple-700 font-bold">** (Exponentiation)</p>
                <p class="text-xs text-center text-purple-800">The Power Stack: Rapidly stacks the base, multiplying it by itself.</p>
            </div>
        </div>
    </section>

    ---

    <section id="simulation" class="max-w-6xl mx-auto mb-12 bg-white rounded-xl shadow-lg border-2 border-purple-300 p-6">
        <h2 class="text-2xl font-bold mb-4 text-purple-700">2. üß† The Simulation: Tracing Factory Production ($A=2, B=3$)</h2>
        <p class="mb-4">Watch the raw number blocks $A=2$ and $B=3$ get processed by the Power Stack (**) and the Remainder Isolator (%).</p>

        <div class="flex gap-6">
            <div class="w-1/2">
                <p class="font-bold mb-2">Production Trace Log:</p>
                <table class="w-full text-sm border-collapse">
                    <thead>
                        <tr class="bg-purple-600 text-white">
                            <th class="p-2 border border-purple-700">#</th>
                            <th class="p-2 border border-purple-700">Line of Code</th>
                            <th class="p-2 border border-purple-700">A</th>
                            <th class="p-2 border border-purple-700">B</th>
                            <th class="p-2 border border-purple-700">Power</th>
                            <th class="p-2 border border-purple-700">Remainder</th>
                        </tr>
                    </thead>
                    <tbody id="trace-table-2">
                        </tbody>
                </table>
                <button id="start-trace" onclick="runTraceSimulation()" class="mt-4 bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700 transition duration-150 w-full">
                    ‚ñ∂Ô∏è Start Trace
                </button>
            </div>

            <div class="w-1/2">
                <p class="font-bold mb-2">Factory Process Visualization:</p>
                <div id="factory-visual" class="relative bg-slate-100 border-4 border-slate-300 rounded-lg p-4 min-h-[250px] flex flex-col justify-around">
                    <div id="trace-output-area" class="flex justify-around items-center h-full">
                        <div id="block-a" class="number-block bg-purple-300">A=2</div>
                        <div id="block-b" class="number-block bg-purple-300">B=3</div>
                    </div>
                    
                    <div id="power-machine" class="absolute top-1/2 left-1/4 transform -translate-y-1/2 machine bg-purple-100 opacity-0 transition-opacity duration-500">
                        <span class="machine-icon">üöÄ</span>
                        <p class="operator text-purple-700">**</p>
                    </div>
                    
                    <div id="remainder-machine" class="absolute top-1/2 right-1/4 transform -translate-y-1/2 machine bg-pink-100 opacity-0 transition-opacity duration-500">
                        <span class="machine-icon">üì¶</span>
                        <p class="operator text-pink-700">%</p>
                    </div>
                    
                    <div id="result-power" class="absolute top-1/4 left-1/4 opacity-0"></div>
                    <div id="result-remainder" class="absolute top-1/4 right-1/4 opacity-0"></div>
                    <div id="sound-log" class="absolute top-0 left-0 right-0 h-10"></div>
                </div>
            </div>
        </div>
    </section>

    ---

    <section id="trap" class="max-w-6xl mx-auto mb-12 bg-white rounded-xl shadow-lg border-2 border-purple-300 p-6">
        <h2 class="text-2xl font-bold mb-4 text-purple-700">3. üö© The Trap: Fluid vs. Whole ( / vs. // )</h2>
        <p class="mb-4">The common trap is confusing standard division (/) with floor division (//). Drag the missing slash ($/$) to the correct position to fix the code and use the Whole Number Splitter!</p>

        <div class="grid grid-cols-2 gap-8">
            <div>
                <h3 class="text-xl font-bold text-red-700 mb-3">‚ùå The Trap (Messy Division)</h3>
                <div class="bg-red-50 p-4 rounded-lg border-4 border-red-400">
                    <p class="font-mono mb-3">clean_result = 10 / 3</p>
                    <div class="flex items-center justify-center gap-4 relative">
                        <div class="machine bg-blue-100 border-2 border-blue-300 w-24">
                            <span class="machine-icon">‚ûó</span>
                            <p class="operator text-blue-700">/</p>
                        </div>
                        <div id="trap-result-block" class="number-block float-residue bg-blue-300 w-32 h-12 text-lg">3.33...</div>
                        <p class="absolute -bottom-6 text-sm text-red-700 font-semibold">Factory Alert! Float data detected!</p>
                    </div>
                </div>
            </div>
            
            <div id="fix-container" class="bg-green-50 p-4 rounded-lg border-4 border-green-400">
                <h3 class="text-xl font-bold text-green-700 mb-3">‚úÖ Fix the Splitter! (10 /<span id="drop-target" class="drop-target"></span> 3)</h3>
                <div class="font-mono mb-3 text-lg">clean_result = 10 /<span id="slash-drop-area" class="drop-target"></span> 3</div>
                
                <div class="flex items-center justify-center gap-4 mt-6">
                    <div id="fix-machine" class="machine bg-blue-100 border-2 border-blue-300 w-24 transition-colors duration-500">
                        <span class="machine-icon" id="fix-machine-icon">‚ûó</span>
                        <p class="operator text-blue-700" id="fix-machine-operator">/</p>
                    </div>
                    <div id="fix-result-block" class="number-block bg-blue-300 w-32 h-12 text-lg">3.33...</div>
                </div>

                <div class="flex justify-center mt-6">
                    <span id="slash-drag-icon" class="slash-icon text-yellow-800" draggable="true" ondragstart="dragSlash(event)">/</span>
                </div>
                
                <div id="fix-message" class="text-green-700 text-center font-semibold mt-3">Drag the slash into the dashed box to complete the operator!</div>
            </div>
        </div>
    </section>

    ---

    <section id="playground" class="max-w-6xl mx-auto mb-12 bg-white rounded-xl shadow-lg border-2 border-purple-300 p-6">
        <h2 class="text-2xl font-bold mb-4 text-purple-700">4. üéÆ The Playground: Power Stack Mission!</h2>
        <p class="mb-4 font-bold text-purple-800">MISSION: The warehouse needs a Block <span id="target-number-display" class="text-3xl font-extrabold text-red-600">125</span>! Use the Power Stack machine (**) to reach the target!</p>
        
        <div class="grid grid-cols-3 gap-6 items-start">
            <div class="bg-slate-100 p-4 rounded-lg">
                <p class="font-bold mb-2">Available Blocks:</p>
                <div class="flex flex-wrap gap-2">
                    <div class="number-block">5 (Base)</div>
                    <div class="number-block">3 (Exponent)</div>
                </div>
            </div>

            <div class="bg-slate-800 text-green-400 p-4 rounded-lg font-mono">
                <p class="text-white font-bold mb-2">Code Input (Enter $A**B$):</p>
                <input type="text" id="code-input" class="bg-slate-900 border border-slate-700 text-green-400 p-2 rounded w-full" placeholder="e.g., 5 ** 3">
                <button id="run-mission" onclick="runMission()" class="mt-3 bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700 transition duration-150 w-full">
                    üöÄ Run Power Stack!
                </button>
            </div>

            <div class="bg-purple-50 p-4 rounded-lg border-2 border-purple-300 relative min-h-[150px]">
                <p class="font-bold text-purple-700 mb-2">Factory Output:</p>
                <div id="mission-machine-anim" class="flex justify-center items-center h-full">
                    <div id="mission-result" class="number-block opacity-0">...</div>
                </div>
                <div id="mission-message" class="text-center font-bold mt-2">Awaiting Code...</div>
            </div>
        </div>
    </section>

    <script>
        const delay = ms => new Promise(r => setTimeout(r, ms));

        // --- Section 2: Trace Simulation Logic ---
        const traceData = [
            { step: 1, line: 'A=2, B=3', A: 2, B: 3, Power: '', Remainder: '', action: 'Initialize blocks' },
            { step: 2, line: 'Power = A ** B', A: 2, B: 3, Power: 8, Remainder: '', action: 'Power Stack machine activates! SOUND: WHRRR-TZZZ! The 2 block is stacked 3 times into a finalized 8 block.' },
            { step: 3, line: 'Remainder = A % B', A: 2, B: 3, Power: 8, Remainder: 2, action: 'Remainder Isolator processes 2 / 3. The 2 block is returned as the final leftover piece. TINK.' },
            { step: 4, line: 'Clean_Cut = 7 // 2', A: 2, B: 3, Power: 8, Remainder: 2, action: 'Block 7 enters the Whole Number Splitter (//). Result 3 appears. Scrap flies out.' }
        ];

        const traceTableBody = document.getElementById('trace-table-2');
        const factoryVisual = document.getElementById('factory-visual');
        const blockA = document.getElementById('block-a');
        const blockB = document.getElementById('block-b');
        const powerMachine = document.getElementById('power-machine');
        const remainderMachine = document.getElementById('remainder-machine');
        const resultPower = document.getElementById('result-power');
        const resultRemainder = document.getElementById('result-remainder');
        const soundLog = document.getElementById('sound-log');
        let currentTraceStep = 0;

        function updateTraceTable(data) {
            traceTableBody.innerHTML = '';
            data.forEach((row, index) => {
                const tr = traceTableBody.insertRow();
                tr.classList.add('bg-white', 'hover:bg-purple-50', 'trace-line');
                tr.id = `trace-row-${index}`;
                tr.innerHTML = `
                    <td class="p-2 border">${row.step}</td>
                    <td class="p-2 border font-mono">${row.line}</td>
                    <td class="p-2 border">${row.A}</td>
                    <td class="p-2 border">${row.B}</td>
                    <td class="p-2 border">${row.Power}</td>
                    <td class="p-2 border">${row.Remainder}</td>
                `;
            });
        }

        async function runTraceSimulation() {
            document.getElementById('start-trace').disabled = true;
            updateTraceTable(traceData.map(d => ({...d, Power: '', Remainder: ''})));
            
            // Reset visual elements
            powerMachine.style.opacity = '0';
            remainderMachine.style.opacity = '0';
            blockA.textContent = 'A=2';
            blockB.textContent = 'B=3';
            blockA.classList.remove('remainder-piece');
            resultPower.style.opacity = '0';
            resultRemainder.style.opacity = '0';
            resultPower.innerHTML = '';
            resultRemainder.innerHTML = '';

            await delay(500);

            for (let i = 0; i < traceData.length; i++) {
                const row = traceData[i];
                const traceRow = document.getElementById(`trace-row-${i}`);
                if (traceRow) {
                    document.querySelectorAll('.trace-line').forEach(r => r.classList.remove('active-trace'));
                    traceRow.classList.add('active-trace');
                }
                
                // Show action
                soundLog.innerHTML = `<span class="sound-effect">${row.action.split(':')[0]}</span>`;
                
                if (i === 1) { // Power Stack
                    powerMachine.style.opacity = '1';
                    await delay(1000);
                    resultPower.innerHTML = `<div class="number-block bg-purple-400">8</div>`;
                    resultPower.style.opacity = '1';
                    soundLog.innerHTML = `<span class="sound-effect">WHHH-TZZZ! PROCESS COMPLETE!</span>`;
                    updateTraceTable(traceData.slice(0, 2));
                    document.getElementById(`trace-row-1`).classList.add('active-trace');
                } else if (i === 2) { // Remainder Isolator
                    powerMachine.style.opacity = '0';
                    remainderMachine.style.opacity = '1';
                    await delay(1000);
                    blockA.classList.add('remainder-piece');
                    blockA.textContent = '2'; // Block A is the remainder
                    resultRemainder.innerHTML = `<div class="number-block remainder-piece">2</div>`;
                    resultRemainder.style.opacity = '1';
                    soundLog.innerHTML = `<span class="sound-effect">Remainder Ejected. TINK.</span>`;
                    updateTraceTable(traceData.slice(0, 3));
                    document.getElementById(`trace-row-2`).classList.add('active-trace');
                } else if (i === 3) { // Floor Division (Visual only for analogy)
                    remainderMachine.style.opacity = '0';
                    soundLog.innerHTML = `<span class="sound-effect">Whole Number Splitter: Result 3, Scrap Flies Out.</span>`;
                    // Update trace table to final state
                    updateTraceTable(traceData);
                    document.getElementById(`trace-row-3`).classList.add('active-trace');
                }

                await delay(1500);
            }
            
            soundLog.innerHTML = '';
            document.getElementById('start-trace').disabled = false;
        }
        
        updateTraceTable(traceData.map(d => ({...d, Power: '', Remainder: ''})));


        // --- Section 3: Trap Fix Logic ---
        const slashDropArea = document.getElementById('slash-drop-area');
        const slashDragIcon = document.getElementById('slash-drag-icon');
        const fixMachine = document.getElementById('fix-machine');
        const fixMachineIcon = document.getElementById('fix-machine-icon');
        const fixMachineOperator = document.getElementById('fix-machine-operator');
        const fixResultBlock = document.getElementById('fix-result-block');
        const fixMessage = document.getElementById('fix-message');
        let slashDropped = false;

        function dragSlash(e) {
            e.dataTransfer.setData("text/plain", "/");
            e.dataTransfer.effectAllowed = "move";
        }

        slashDropArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            slashDropArea.style.backgroundColor = '#fef3c7'; // Yellow-100 highlight
        });

        slashDropArea.addEventListener('dragleave', (e) => {
            slashDropArea.style.backgroundColor = 'transparent';
        });

        slashDropArea.addEventListener('drop', (e) => {
            e.preventDefault();
            slashDropArea.style.backgroundColor = 'transparent';
            if (e.dataTransfer.getData("text/plain") === "/" && !slashDropped) {
                slashDropped = true;
                slashDropArea.textContent = '/';
                slashDragIcon.style.opacity = '0.5';
                slashDragIcon.draggable = false;
                
                // Transition to Floor Division
                fixMachine.classList.remove('bg-blue-100', 'border-blue-300');
                fixMachine.classList.add('bg-orange-100', 'border-orange-300');
                fixMachineOperator.textContent = '//';
                fixMachineOperator.classList.remove('text-blue-700');
                fixMachineOperator.classList.add('text-orange-700');
                fixMachineIcon.textContent = '‚úÇÔ∏è';
                
                fixResultBlock.textContent = '3';
                fixResultBlock.classList.remove('float-residue', 'bg-blue-300');
                fixResultBlock.classList.add('bg-green-400');
                
                fixMessage.innerHTML = "üéâ QUALITY CONTROL PASS! Crisp result block <span class='font-bold'>3</span>!";
            } else {
                fixMessage.innerHTML = "Oops! Already fixed or wrong element dropped.";
            }
        });

        // --- Section 4: Playground Logic ---
        const targetNumberDisplay = document.getElementById('target-number-display');
        const codeInput = document.getElementById('code-input');
        const missionResult = document.getElementById('mission-result');
        const missionMessage = document.getElementById('mission-message');

        const target = 125;
        targetNumberDisplay.textContent = target;

        async function runMission() {
            const expression = codeInput.value.trim();
            missionResult.style.opacity = '0';
            missionMessage.textContent = 'Processing...';

            let result;
            try {
                // Safely evaluate the expression (only numbers and ** allowed)
                if (!/^\s*\d+\s*\*\*\s*\d+\s*$/.test(expression)) {
                    // Check for wrong operator (like 5 * 3)
                    if (expression.includes('*') && !expression.includes('**')) {
                        missionMessage.innerHTML = "‚ùå Wrong Operator! You used the <span class='font-bold'>Replication Stamper (*)</span>, not the Power Stack (**)!";
                        return;
                    }
                    missionMessage.innerHTML = "‚ùå Invalid Code: Use only numbers and the ** operator (e.g., 5 ** 3).";
                    return;
                }
                
                // Execute the math using Function constructor (safe for simple arithmetic)
                result = (new Function('return ' + expression))();

            } catch (e) {
                missionMessage.textContent = '‚ùå Code Error! Check your syntax.';
                return;
            }

            // Animation
            await delay(500);
            missionMessage.textContent = 'Power Stack Running...';
            missionResult.textContent = expression; // Show the code in the block briefly
            missionResult.style.opacity = '1';
            missionResult.classList.add('bg-purple-400', 'speaking');
            
            await delay(1000);
            
            missionResult.classList.remove('speaking');
            missionResult.textContent = result;
            
            if (result === target) {
                missionResult.classList.add('bg-yellow-400', 'border-yellow-600', 'font-extrabold');
                missionMessage.innerHTML = "üéâ PRODUCTION GOAL ACHIEVED! Block <span class='font-bold text-3xl'>" + target + "</span> complete!";
            } else {
                missionResult.classList.remove('bg-purple-400');
                missionResult.classList.add('bg-red-400', 'shake');
                missionMessage.innerHTML = "‚ùå Failure! You produced block <span class='font-bold'>" + result + "</span>. We needed " + target + ".";
                setTimeout(() => missionResult.classList.remove('shake'), 500);
            }
        }

    </script>
</body>
</html>
